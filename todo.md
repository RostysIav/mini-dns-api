# Mini DNS API — **Step-by-Step To-Do List**

Use this checklist as your project roadmap.  
☑️ = mandatory for the assessment | ★ = nice-to-have / stretch

---

## 1 ▪ Project Planning
- [ ] **Clarify scope** ☑️  
  - Support `A` and `CNAME` records (+ one optional type: `MX` ★).  
  - Enforce real-world DNS constraints: multi-A, single-CNAME, no record mix, CNAME chaining, loop detection.
- [ ] **Select tech stack** ☑️  
  - Language: Python 3.13.  
  - Framework: FastAPI (async) + Uvicorn.  
  - Data layer: SQLite via SQLModel (file-based, portable).  
  - Testing: Pytest + httpx + pytest-asyncio.  
  - Tooling: Pre-commit (ruff, black, mypy) ★.
- [ ] **Define architecture** ☑️  
  - `app/` package split into `models`, `schemas`, `crud`, `services`, `api`, `core`.  
  - Key service helpers:  
    - `validate_record()`  
    - `detect_cycle()`  
    - `resolve_hostname_chain()`  
    - `normalize_hostname()`  
  - Background tasks queue (FastAPI `BackgroundTasks`) ★.

---

## 2 ▪ Repository & CI
- [x] **Create private GitHub repo** — shared with `developer@speer.io`.
- [x] **Add standard files**  
  - [x] `README.md` - Project documentation  
  - [x] `LICENSE` - MIT License added  
  - [x] `.gitignore` - Python and IDE specific ignores  
  - [x] `pyproject.toml` - Project configuration  
  - [x] `DEV_GUIDE.md` ★ - Development guide added
- [x] **Set up pre-commit**  
  - [x] Black for code formatting  
  - [x] Ruff for linting  
  - [x] mypy for type checking
- [x] **Configure GitHub Actions CI**  
  - [x] Run tests on push/PR to main  
  - [x] Lint code with ruff  
  - [x] Type checking with mypy  
  - [x] Test coverage reporting  
  - [x] Codecov integration

---

## 3 ▪ Environment Setup
- [x] **Create & document virtual env**  
  - [x] Virtual environment setup documented in README.md and DEV_GUIDE.md
  - [x] `.gitignore` updated to exclude virtual environment files

- [x] **Pin dependencies**  
  - [x] Created `requirements.in` with direct dependencies
  - [x] Generated `requirements.txt` with pinned versions
  - [x] Created `requirements-dev.txt` for development dependencies
  - [x] Updated `pyproject.toml` with all dependencies
  - [x] Added `pip-tools` for dependency management
  - [x] Created `.env` file template with default configuration

---

## 4 ▪ Domain Modeling
- [x] **Database schema**  
  - [x] `Host` model with hostname (unique) and timestamps  
  - [x] `Record` model with type (A, CNAME, MX), value, and relationships  
  - [x] SQLAlchemy models with proper constraints and relationships  
  - [x] Database migrations support (via SQLAlchemy)  
  - [x] Connection pooling and configuration

- [x] **Pydantic schemas**  
  - [x] `HostCreate`, `HostRead`, `HostUpdate`  
  - [x] `RecordCreate`, `RecordRead`, `RecordUpdate`  
  - [x] `RecordList` for paginated responses  
  - [x] `ResolveResponse` for DNS resolution results  
  - [x] Proper validation and type hints

- [x] **Database configuration**  
  - [x] SQLite support with WAL mode  
  - [x] PostgreSQL and MySQL support (configurable)  
  - [x] Connection pooling and timeouts  
  - [x] Environment-based configuration  
  - [x] Session management with context managers

---

## 5 ▪ Core Business Logic ✅
- [x] **Validation utilities**  
  - [x] IPv4 validation using `ipaddress.IPv4Address`  
  - [x] Hostname RFC-compliant pattern  
  - [x] Duplicate record checks  
  - [x] Conflict checks (CNAME vs A/MX)  
- [x] **CNAME chain resolution**  
  - [x] Depth-first traversal with visited-set for loop detection  
  - [x] Max chain length constant (8 by default)  
  - [x] `/cname-chain/{hostname}` endpoint to inspect chains  
- [x] **Background tasks framework**  
  - [x] Async task scheduler  
  - [x] Periodic record expiry check  
  - [x] Stats aggregation  
  - [x] Graceful startup/shutdown

---

## 6 ▪ API Layer ✅
- [x] **Add DNS Record** `POST /api/records/`  
  - [x] Validate payload  
  - [x] Create record  
  - [x] Return HTTP 201 with created record  
- [x] **Resolve Hostname** `GET /api/resolve/{hostname}`  
  - [x] Follow CNAME chains  
  - [x] Return final IP list or error  
  - [x] Support record type filtering  
- [x] **List Records** `GET /api/records/`  
  - [x] Return all records  
  - [x] Support filtering by host_id  
- [x] **CNAME Chain** `GET /api/cname-chain/{hostname}`  
  - [x] Return full CNAME resolution chain  
  - [x] Support max depth parameter  
- [x] **OpenAPI Documentation**  
  - [x] Auto-generated by FastAPI  
  - [x] Available at `/docs` and `/redoc`

## 7 ▪ API Testing ✅
- [x] **Test DNS Record Creation**
  - [x] Test valid record creation (RECORD-001, RECORD-002)
  - [x] Test invalid record validation (RECORD-003, RECORD-004)
  - [x] Test duplicate record prevention (HOST-002, RECORD-005)
  - [x] Test CNAME conflict rules (RECORD-006)
  - [x] Test record type validation (RECORD-007)

- [x] **Test DNS Resolution**
  - [x] Test direct A record resolution (RESOLVE-001)
  - [x] Test CNAME chain resolution (RESOLVE-002)
  - [x] Test resolution with record type filter (RESOLVE-003)
  - [x] Test error cases (RESOLVE-004, RESOLVE-005)

- [x] **Test CNAME Chain Endpoint**
  - [x] Test simple CNAME chain (CNAME-001)
  - [x] Test chain with max depth limit (CNAME-002)
  - [x] Test loop detection (CNAME-003)
  - [x] Test error cases (CNAME-004)

- [x] **Test Error Handling**
  - [x] Test invalid input validation (ERROR-001 to ERROR-005)
  - [x] Test not found scenarios (ERROR-101 to ERROR-103)
  - [x] Test conflict scenarios (ERROR-201 to ERROR-203)
  - [x] Test malformed requests (ERROR-301 to ERROR-303)

- [x] **Test Coverage**
  - [x] Unit tests for all components
  - [x] Integration tests for API endpoints
  - [x] Test data cleanup after tests
  - [x] Test documentation in TESTING_GUIDE.md

---

## 8 ▪ Error Handling ✅
- [x] Centralised exception handlers with custom error responses
- [x] Custom error codes and messages for all error cases
- [x] Error categories:
  - [x] Validation errors (400)
  - [x] Not found errors (404)
  - [x] Conflict errors (409)
  - [x] DNS-specific errors (400)
  - [x] Rate limiting (429)
  - [x] Server errors (500)
- [x] Detailed error responses with:
  - Error code
  - Human-readable message
  - Status code
  - Additional context where applicable

---

## 8 ▪ Unit & Integration Tests ✅
- [x] **Test Coverage**  
  - [x] Unit tests for all core functionality
  - [x] Integration tests for API endpoints
  - [x] Test coverage ≥ 90%
  - [x] Configured pytest with coverage reporting

- [x] **Test Suites**  
  - [x] Happy-path CRUD operations for hosts and records
  - [x] Validation failures and error cases
  - [x] CNAME chaining and loop detection
  - [x] DNS resolution with various record types
  - [x] MX record handling with priorities
  - [x] Error handling and edge cases

- [x] **Test Utilities**  
  - [x] Test fixtures for database setup/teardown
  - [x] Helper functions for test data creation
  - [x] Custom assertions for error responses
  - [x] Test configuration (pytest.ini)

- [x] **Test Data**  
  - [x] Factory functions for test data
  - [x] Sample test data for all record types
  - [x] Test data cleanup after each test

---

## 9 ▪ Documentation
- [ ] **Expand `README.md`** ☑️  
  - Project intro, stack, requirements.  
  - Setup & run (venv + Docker).  
  - Endpoint table with request/response samples.  
  - DNS constraints & design rationale.  
  - Async/queue explanation.  
  - How AI tools were used (attach chat link / note inline comments).  
- [ ] **Example `curl` scripts / Postman collection** ☑️.  
- [ ] Architecture diagram (`docs/architecture.png`) ★.

---

## 10 ▪ Manual QA & Linting
- [ ] Run local server ➜ hit endpoints with edge cases. ☑️  
- [ ] Ensure `uvicorn app.main:app --reload` works. ☑️  
- [ ] Pass all pre-commit hooks / CI green. ☑️

---

## 11 ▪ Packaging & Submission
- [ ] Tag version `v1.0.0` in Git. ☑️  
- [ ] Double-check private repo access for evaluator. ☑️  
- [ ] Confirm README includes **AI usage disclosure**. ☑️  
- [ ] Push final commit & notify reviewer. ☑️
