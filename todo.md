# Mini DNS API — **Step-by-Step To-Do List**

Use this checklist as your project roadmap.  
☑️ = mandatory for the assessment | ★ = nice-to-have / stretch

---

## 1 ▪ Project Planning
- [ ] **Clarify scope** ☑️  
  - Support `A` and `CNAME` records (+ one optional type: `MX` ★).  
  - Enforce real-world DNS constraints: multi-A, single-CNAME, no record mix, CNAME chaining, loop detection.
- [ ] **Select tech stack** ☑️  
  - Language: Python 3.13.  
  - Framework: FastAPI (async) + Uvicorn.  
  - Data layer: SQLite via SQLModel (file-based, portable).  
  - Testing: Pytest + httpx + pytest-asyncio.  
  - Tooling: Pre-commit (ruff, black, mypy) ★.
- [ ] **Define architecture** ☑️  
  - `app/` package split into `models`, `schemas`, `crud`, `services`, `api`, `core`.  
  - Key service helpers:  
    - `validate_record()`  
    - `detect_cycle()`  
    - `resolve_hostname_chain()`  
    - `normalize_hostname()`  
  - Background tasks queue (FastAPI `BackgroundTasks`) ★.

---

## 2 ▪ Repository & CI
- [x] **Create private GitHub repo** — shared with `developer@speer.io`.
- [x] **Add standard files**  
  - [x] `README.md` - Project documentation  
  - [x] `LICENSE` - MIT License added  
  - [x] `.gitignore` - Python and IDE specific ignores  
  - [x] `pyproject.toml` - Project configuration  
  - [x] `DEV_GUIDE.md` ★ - Development guide added
- [x] **Set up pre-commit**  
  - [x] Black for code formatting  
  - [x] Ruff for linting  
  - [x] mypy for type checking
- [x] **Configure GitHub Actions CI**  
  - [x] Run tests on push/PR to main  
  - [x] Lint code with ruff  
  - [x] Type checking with mypy  
  - [x] Test coverage reporting  
  - [x] Codecov integration

---

## 3 ▪ Environment Setup
- [x] **Create & document virtual env**  
  - [x] Virtual environment setup documented in README.md and DEV_GUIDE.md
  - [x] `.gitignore` updated to exclude virtual environment files

- [x] **Pin dependencies**  
  - [x] Created `requirements.in` with direct dependencies
  - [x] Generated `requirements.txt` with pinned versions
  - [x] Created `requirements-dev.txt` for development dependencies
  - [x] Updated `pyproject.toml` with all dependencies
  - [x] Added `pip-tools` for dependency management
  - [x] Created `.env` file template with default configuration

---

## 4 ▪ Domain Modeling
- [x] **Database schema**  
  - [x] `Host` model with hostname (unique) and timestamps  
  - [x] `Record` model with type (A, CNAME, MX), value, and relationships  
  - [x] SQLAlchemy models with proper constraints and relationships  
  - [x] Database migrations support (via SQLAlchemy)  
  - [x] Connection pooling and configuration

- [x] **Pydantic schemas**  
  - [x] `HostCreate`, `HostRead`, `HostUpdate`  
  - [x] `RecordCreate`, `RecordRead`, `RecordUpdate`  
  - [x] `RecordList` for paginated responses  
  - [x] `ResolveResponse` for DNS resolution results  
  - [x] Proper validation and type hints

- [x] **Database configuration**  
  - [x] SQLite support with WAL mode  
  - [x] PostgreSQL and MySQL support (configurable)  
  - [x] Connection pooling and timeouts  
  - [x] Environment-based configuration  
  - [x] Session management with context managers

---

## 5 ▪ Core Business Logic
- [ ] **Validation utilities** ☑️  
  - IPv4 regex / `ipaddress.IPv4Address`.  
  - Hostname RFC-compliant pattern.  
  - Duplicate record checks.  
  - Conflict checks (CNAME vs A/MX).  
- [ ] **CNAME chain resolution** ☑️  
  - Depth-first traversal with visited-set for loop detection.  
  - Max chain length constant (e.g., 8).  
- [ ] **Background tasks framework** ★  
  - Async queue for periodic record expiry or stats aggregation (document even if unused).

---

## 6 ▪ API Layer
- [ ] **Add DNS Record** `POST /api/dns` ☑️  
  - Validate payload ➜ create record ➜ HTTP 201.  
- [ ] **Resolve Hostname** `GET /api/dns/{hostname}` ☑️  
  - Follow CNAMEs ➜ return final IP list / error.  
- [ ] **List Records** `GET /api/dns/{hostname}/records` ☑️  
  - Return all records for host.  
- [ ] **Delete Record** `DELETE /api/dns/{hostname}?type=&value=` ☑️  
  - Delete specific mapping ➜ 204 NO CONTENT.  
- [ ] **OpenAPI docs** auto-generated by FastAPI. ☑️

---

## 7 ▪ Error Handling
- [ ] Centralised exception handlers (`HTTPException`) ☑️.  
- [ ] Custom error codes/messages for:  
  - Invalid hostname/IP.  
  - Duplicate record.  
  - CNAME conflict.  
  - Circular reference.  
  - Record not found.

---

## 8 ▪ Unit & Integration Tests
- [ ] **Coverage targets ≥ 90 %** ☑️  
- [ ] Test suites:  
  - Happy-path CRUD ops.  
  - Validation failures.  
  - CNAME chaining & loop rejection.  
  - Resolve endpoints (multi-A, deep CNAME).  
  - Optional record type (MX) ★.  
- [ ] **Test data factory** (`pytest-factoryboy`) ★.

---

## 9 ▪ Documentation
- [ ] **Expand `README.md`** ☑️  
  - Project intro, stack, requirements.  
  - Setup & run (venv + Docker).  
  - Endpoint table with request/response samples.  
  - DNS constraints & design rationale.  
  - Async/queue explanation.  
  - How AI tools were used (attach chat link / note inline comments).  
- [ ] **Example `curl` scripts / Postman collection** ☑️.  
- [ ] Architecture diagram (`docs/architecture.png`) ★.

---

## 10 ▪ Manual QA & Linting
- [ ] Run local server ➜ hit endpoints with edge cases. ☑️  
- [ ] Ensure `uvicorn app.main:app --reload` works. ☑️  
- [ ] Pass all pre-commit hooks / CI green. ☑️

---

## 11 ▪ Packaging & Submission
- [ ] Tag version `v1.0.0` in Git. ☑️  
- [ ] Double-check private repo access for evaluator. ☑️  
- [ ] Confirm README includes **AI usage disclosure**. ☑️  
- [ ] Push final commit & notify reviewer. ☑️
